(self.webpackChunkstatic=self.webpackChunkstatic||[]).push([[671],{5857:(e,t,a)=>{"use strict";a.d(t,{Z:()=>l});var s=a(7294),r=a(4214),i=a(6872);class l extends s.Component{constructor(e){super(e),this.showAddArea=!1}render(){return s.createElement("div",{className:"row add-one-area",style:{border:this.showAddArea?"1px dotted #999":"",padding:this.showAddArea?"1em":"",margin:"0px 0px 1em"}},s.createElement("button",{type:"button",className:"btn btn-green btn-outlined  btn-xs",style:{display:"block"},onClick:()=>{this.showAddArea=!0,this.forceUpdate()}},s.createElement("span",{className:"fa fa-plus",style:{marginRight:".3em"}}),"添加 ",this.props.resourceName),this.showAddArea?s.createElement(s.Fragment,null,s.createElement("div",{className:"col-12"},s.createElement(r.Y,{fields:this.props.fields})),s.createElement("div",{className:"col-lg-12 col-md-12 col-sm-12",style:{margin:"1em 0"}},s.createElement("button",{type:"button",className:"btn btn-green btn-outlined btn-xs",onClick:()=>{let e=(0,i.Rj)(this.props.fields);if(e)return void alert(e);let t=this.props.fields.reduce(((e,t)=>Object.assign(e,{[t.attr]:t.value})),{});this.props.onAddOne(t)}},"确定"),"  ",s.createElement("button",{type:"button",className:"btn btn-green btn-outlined btn-xs",onClick:()=>{this.showAddArea=!1,this.forceUpdate()}},"隐藏"))):null)}}},233:(e,t,a)=>{"use strict";a.d(t,{L:()=>o});var s=a(7294),r=a(8447),i=a(4214),l=a(7632),n=a(197);class o extends s.Component{constructor(e){super(e),this.state={dataFetching:!0,categoryTagSelection:{selectedCategoryIds:[],selectedTagIds:[]}}}componentDidMount(){this.showPage(1)}ui_Part_CategoryTag(){let e=this.state.categoryTagSelection;return e.selectedCategoryIds.length+e.selectedTagIds.length>0||this.props.data.pagedata.total>=5?s.createElement(n.D,{selections:this.state.categoryTagSelection,tagsSelectionChange:e=>{this.showPage(1)},categoriesSelectionChange:e=>{this.showPage(1)}}):null}ui_Part_SearchBox(){return""!=this.props.data.pagedata.keywords||this.props.data.pagedata.total>=5?s.createElement("div",{className:"input-group mb-3 input-group-sm",style:{maxWidth:"20em",marginRight:"1em"}},s.createElement("input",{type:"text",className:"form-control",placeholder:this.props.searchBoxHint?this.props.searchBoxHint:"请输入关键词搜索",onChange:e=>{this.props.data.keywords=e.target.value,this.forceUpdate()},onKeyDown:e=>{"Enter"==e.key&&this.showPage(1)}}),s.createElement("span",{className:"input-group-append"},s.createElement("button",{className:"btn btn-default btn-flat",onClick:e=>{this.showPage(1)}},s.createElement("i",{className:"fa fa-search",style:{color:"#92bbcf"}})))):null}ui_Part_Filter(){return this.props.filters?this.props.filters.map((e=>{if("FlipButton"===e.type){let t=e.value?{backgroundColor:"#4CAF50",color:"white"}:{backgroundColor:"#dddddd",color:"#8b8383"};return s.createElement("button",{className:"btn btn-xs btn-flat",key:e.attr,style:{...t,marginRight:"1em",height:"2.5em"},onClick:t=>{e.value=!e.value,this.showPage(1)}},e.name)}})):null}ui_Part_Paginator(){return this.props.data.pagedata.total>=this.props.pageSize?s.createElement(r.Z,{innerClass:"pagination pagination-sm",prevPageText:"<",nextPageText:">",firstPageText:"首页",lastPageText:"尾页",linkClass:"page-link",itemClass:"page-item",activePage:this.props.data.curPage,itemsCountPerPage:this.props.pageSize,totalItemsCount:this.props.data.pagedata.total,pageRangeDisplayed:8,onChange:e=>{this.props.data.curPage!=e&&(this.props.data.curPage=e,this.showPage(e))}}):null}oneListItem(e,t,a){let r=this.props,n="search-result-item";return r.searchResultCssClass&&(n=r.searchResultCssClass(e)),!0===e._editing?s.createElement(l.Z,{key:e.id,data:{fields:e._editing_data},onEditOK:t=>{r.onModifyOne(e,t,this),e._editing=!1,this.forceUpdate()},onEditCancel:()=>{e._editing=!1,this.forceUpdate()}}):this.props.customListItem?this.props.customListItem(e,t,a,this):s.createElement("div",{key:e.id,className:n},r.itemUrl?s.createElement("a",{target:r.openItemSelfWindow?"_self":"_blank",href:r.itemUrl(e)},s.createElement(i.D,{fields:r.list_fields,item:e})):s.createElement(i.D,{fields:r.list_fields,item:e}),s.createElement("div",{className:"search-result-item-actionbar"},s.createElement("div",{className:"btn-group btn-group-sm","data-toggle":"buttons"},r.customBottomElements?r.customBottomElements.map(((t,a)=>t(e,a,this))):null,r.customBottomButtons?r.customBottomButtons.map((t=>t.showCondition&&!t.showCondition(e)?null:s.createElement("span",{className:"btn",key:t.name,style:t.style?t.style:{},type:"button",className:"btn",onClick:()=>t.onClick(e,this)},t.name))):null,r.onModifyOne?s.createElement("span",{type:"button",className:"btn",onClick:async()=>{e._editing_data=await r.createFieldsWhenModifyOne(e),e._editing=!0,this.forceUpdate()}},"编辑"):null,r.onDeleteOne?s.createElement("span",{type:"button",className:"btn",onClick:()=>r.onDeleteOne(e.id)},"删除"):null))," ")}render(){return s.createElement(s.Fragment,null,this.props.display_category_tag?this.ui_Part_CategoryTag():null,s.createElement("div",{className:"row",style:{margin:"0 0 1em 0"}},this.ui_Part_Filter(),this.props.withoutSearchBox?null:this.ui_Part_SearchBox(),this.ui_Part_Paginator()),this.state.dataFetching?s.createElement("div",{className:"row"},s.createElement("h6",{style:{color:"#127f93",margin:"3em",textAlign:"center"}},"数据获取中... ")):0===this.props.data.pagedata.total?s.createElement("div",{className:"row"},s.createElement("h6",{style:{color:"#127f93",margin:"3em",textAlign:"center"}},"没有找到相关记录")):this.props.data.pagedata.items.map(((e,t,a)=>this.oneListItem(e,t,a))))}async showPage(e){if(e&&(this.props.data.curPage=e),this.props.display_category_tag){let e=this.state.categoryTagSelection,t=e.selectedCategoryIds.length+e.selectedTagIds.length>0?JSON.stringify(this.state.categoryTagSelection):null;this.setState({dataFetching:!0}),await this.props.fetchItems(this.props.data.curPage,t),this.setState({dataFetching:!1})}else this.setState({dataFetching:!0}),this.props.fetchItems(this.props.data.curPage),this.setState({dataFetching:!1})}}},1090:(e,t,a)=>{"use strict";a.d(t,{B:()=>o,C:()=>c});var s=a(7294),r=a(5857),i=a(233),l=a(6872);function n(){return(n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e}).apply(this,arguments)}class o extends s.Component{constructor(e){super(e),this.plcData={curPage:1,keywords:"",pagedata:{items:[]}},this.pageSize=this.props.pageSize?this.props.pageSize:5,this.listbypage_extraPara=this.props.listbypage_extraPara}componentDidUpdate(e){JSON.stringify(this.listbypage_extraPara)!==JSON.stringify(this.props.listbypage_extraPara)&&(this.listbypage_extraPara=this.props.listbypage_extraPara,this.listbypage())}async listbypage(e=null,t=null){null===e&&(e=this.plcData.curPage);let a={action:"listbypage",pagenum:e,pagesize:this.pageSize,keywords:this.plcData.keywords.trim()};null!==t&&(a.categorytags=t);let s=this.props.listbypage_extraPara?this.props.listbypage_extraPara:{};a={...a,...s},this.props.filters&&(a.filters=this.props.filters.reduce(((e,t)=>Object.assign(e,{[t.attr]:t.value})),{}));let r=this.props.listbypage_method?this.props.listbypage_method:"get",i=await l._Y.rfetch(r,this.props.resourceUrl,a);this.plcData.pagedata=i,this.forceUpdate()}renderList(){return s.createElement(i.L,n({},this.props,{data:this.plcData,fetchItems:(e,t)=>{this.listbypage(e,t)},pageSize:this.pageSize}))}render(){return this.renderList()}}class c extends o{async onAddOne(e){this.plcData.curPage=1,this.props.addExtraHandle&&this.props.addExtraHandle(e),await l._Y.rfetch("post",this.props.resourceUrl,{action:"addone",data:e}),this.listbypage(1)}async onDeleteOne(e){confirm(`确定要删除此${this.props.resourceName}吗？`)&&(await l._Y.rfetch("delete",this.props.resourceUrl,{action:"deleteone",id:e}),this.listbypage())}async onModifyOne(e,t){let a={},s=Object.getOwnPropertyNames(t);for(let r of s)this.props.modifyExtraHandle&&this.props.modifyExtraHandle(e,a,t,r)||("categorytags"!==r?t[r]!=e[r]&&(a[r]=t[r]):JSON.stringify(t.categorytags)!=JSON.stringify(e.categorytags)&&(a[r]=t[r]));0!==Object.keys(a).length&&(await l._Y.rfetch("put",this.props.resourceUrl,{action:"modifyone",id:e.id,newdata:a}),this.listbypage())}render(){return s.createElement(s.Fragment,null,this.props.withoutAdd?null:this.renderAddOne(),this.renderList())}renderAddOne(){return s.createElement(r.Z,{resourceName:this.props.resourceName,onAddOne:e=>{this.onAddOne(e)},fields:this.props.addone_fields})}renderList(){return s.createElement(i.L,n({},this.props,{data:this.plcData,fetchItems:(e,t)=>{this.listbypage(e,t)},onDeleteOne:this.props.withoutDelete?null:e=>{this.onDeleteOne(e,this.plcData.curPage)},createFieldsWhenModifyOne:async e=>await this.props.createFieldsWhenModifyOne(e),onModifyOne:this.props.withoutModify?null:(e,t,a)=>{this.onModifyOne(e,t,a)},pageSize:this.pageSize}))}}},4214:(e,t,a)=>{"use strict";a.d(t,{Y:()=>c,D:()=>p});var s=a(7294),r=a(6239),i=a(7407),l=a(4182),n=a(197),o=a(5008);class c extends s.Component{constructor(e){super(e)}render(){return this.props.fields.map(((e,t)=>s.createElement("div",{key:t,style:{marginTop:"1em"}},e.name,(()=>{switch(e.type){case"OneLineText":return e.hasOwnProperty("value")||(e.value=""),s.createElement("input",{className:"form-control form-control-sm",value:e.value,onChange:t=>{e.value=t.target.value,this.forceUpdate()}});case"DateTime":return e.hasOwnProperty("value")||(e.value=new Date),s.createElement(s.Fragment,null,s.createElement("br",null),s.createElement("input",{type:"datetime-local",value:e.displayValue,onChange:t=>{e.displayValue=t.target.value,e.value=new Date(t.target.value).toISOString(),this.forceUpdate()}}));case"MultiLineText":return e.hasOwnProperty("value")||(e.value=""),s.createElement("textarea",{className:"form-control form-control-sm",value:e.value,rows:e.rows?e.rows:"4",onChange:t=>{e.value=t.target.value,this.forceUpdate()}});case"RichText":return e.hasOwnProperty("value")||(e.value=""),s.createElement(i.Rm,{value:e.value,onChange:t=>{e.value=t}});case"RichTextEditWithUploader":return e.hasOwnProperty("value")||(e.value=""),s.createElement(i.vr,{value:e.value,onChange:t=>{e.value=t}});case"SingleImg":return s.createElement(l.A,{imageUrl:e.value,imageChanged:t=>{e.value=t},imageStyle:e.imageStyle});case"VideoUpload":return s.createElement(l.j,{items:e.value});case"CategoryTag":return s.createElement(n.D,{selections:e.value});case"FolderSelectWithSort":return s.createElement(o.Fg,{items:e.value,displayAttr:e.displayAttr,foldertype:e.foldertype});case"ListSelectWithSort":return s.createElement(o.zU,{items:e.value,displayAttr:e.displayAttr,searchfunc:e.searchfunc});case"MagicBagSelect":return s.createElement(o.Ll,{zone:e.zone,items:e.value,displayAttr:e.displayAttr});case"SingleSelectFixedItems":return e.hasOwnProperty("value")||(e.value=null),s.createElement("select",{className:"form-control form-control-sm",size:e.showsize,value:e.value,style:{width:"50%",border:"1px #3c763d solid"},onChange:t=>{e.value=parseInt(t.target.value),this.forceUpdate()}},e.items.map((e=>s.createElement("option",{key:e.value,value:e.value},e.text))));case"SingleSelectWithKeywords":return e.hasOwnProperty("value")||(e.value=null),s.createElement(r.bW,{info:e});case"MultiSelectWithKeywords":return e.hasOwnProperty("value")||(e.value=null),s.createElement(r._A,{info:e});case"MultiSelectWithKeywordsAndExtraValues":return e.hasOwnProperty("value")||(e.value=null),s.createElement(r.A1,{info:e});default:e.hasOwnProperty("value")||(e.value=null);const t=e.type;return s.createElement(t,{info:e})}})())))}}class p extends s.Component{constructor(e){super(e)}render(){return this.props.fields.map(((e,t)=>s.createElement("div",{key:t,className:"search-result-item-field",style:e.style},s.createElement("span",null,e.name),(()=>{let t=this.props.item?this.props.item[e.attr]:e.value;switch(e.converter&&(t=e.converter(t)),e.type){case"OneLineText":return s.createElement("span",null,t);case"MultiLineText":return s.createElement("p",null,t);case"RichText":return s.createElement(i.aw,{value:t||""});case"DateTime":return s.createElement("p",null,UTCTimeString2Local(t));case"SingleImg":return s.createElement("img",{src:t,style:e.style});default:return null}})())))}}},8463:(e,t,a)=>{"use strict";a.d(t,{a:()=>n,O:()=>o});var s=a(7294),r=a(4214),i=a(6872),l=a(1090);class n extends s.Component{constructor(e){super(e),this.state={canCreateWF:!1},this.pagesize=20}componentDidMount(){this.WITHOUT_CREATE_BUTTON||i._Y.ajax_get(this.workflowApiUrl,{action:"canicreatewf"},(e=>{this.setState({canCreateWF:e.permitted})}))}clickCreateWorkFlowRec(){window.location.href=this.handleOneUrl+"-1"}render(){return s.createElement(s.Fragment,null,this.PAGE_TITLE?s.createElement("h5",{style:{color:"#52769a",textAlign:"center"}},"   ",this.PAGE_TITLE):null,this.state.canCreateWF?s.createElement("div",{className:"row"},s.createElement("button",{type:"button",className:"btn btn-green btn-outlined  btn-sm",style:{display:"block",margin:".1em auto"},onClick:()=>{this.clickCreateWorkFlowRec()}},s.createElement("span",{className:"fa fa-plus",style:{marginRight:".3em"}}),"创建 ",this.workflowname)):null,s.createElement(l.B,{resourceUrl:this.workflowApiUrl,listbypage_method:"post",pageSize:this.pageSize,list_fields:this.list_fields,searchResultCssClass:this.searchResultCssClass,listbypage_extraPara:{action:this.api_list_action},itemUrl:e=>this.handleOneUrl+e.id+(this.wfd_id?"&wfd_id="+this.wfd_id:""),openItemSelfWindow:!0,filters:this.filters}))}}class o extends s.Component{constructor(e){super(e),this.state={wf:{id:parseInt(i._Y.getUrlParameter("id")),title:""},avalialeActions:null,curAction:null,actionData:null}}componentDidMount(){this.loadPage()}loadPage(){let e=parseInt(i._Y.getUrlParameter("id"));this.getWorkFlowRec(e)}getWorkFlowRec(e){i._Y.ajax_get(this.workflowApiUrl,{action:"getone",wf_id:e,withwhatcanido:!0},(e=>{this.setState({wf:e.rec,avalialeActions:e.whaticando,curAction:null,actionData:null})}))}render(){return s.createElement(s.Fragment,null,s.createElement("h5",{style:{color:"#52769a",textAlign:"center",paddingTop:"0em"}},"   ",this.state.wf.title,"  "),s.createElement("div",{className:"row",style:{marginTop:"1em"}},s.createElement("button",{type:"button",className:"btn btn-green btn-outlined  btn-sm",style:{display:"block",marginLeft:"auto"},onClick:()=>{this.props.history.push(i._Y.getUrlParameter("backtolisturl"))}},s.createElement("span",{className:"fa fa-list",style:{marginRight:".3em"}}),"查看 ",this.workflowname," 记录")),this.renderTimeline(),null===this.state.avalialeActions?null:s.createElement("div",{className:"row",style:{marginTop:"1em"}},this.state.avalialeActions.map((e=>s.createElement("button",{type:"button",key:e.name,className:"btn btn-green btn-outlined  btn-xs",style:{display:"block",marginLeft:"1em"},onClick:()=>{this.state.curAction=e,this.setState({actionData:JSON.parse(JSON.stringify(e.submitdata))})}},e.name)))),null===this.state.actionData?null:s.createElement("div",{className:"col-12"},s.createElement("h5",{style:{marginTop:"1em",color:"#954d4d"}},"  ",this.state.curAction.name," "),s.createElement(r.Y,{fields:this.state.actionData}),s.createElement("div",{className:"col-12",style:{marginTop:"1.5em"}},s.createElement("button",{type:"button",className:"btn btn-green btn-outlined btn-xs",onClick:()=>{let e=(0,i.Rj)(this.state.actionData);if(e)return void alert(e);let t=JSON.parse(JSON.stringify(this.state.actionData));for(let e of t)for(let t in e)t.startsWith("check_")&&delete e[t];let a={action:"stepaction",name:this.state.curAction.name,wf_id:this.state.wf.id,submitdata:t,wf_url:location.href};this.wfd_id&&(a.wfd_id=this.wfd_id),i._Y.ajax_post(this.workflowApiUrl,a,(e=>{let t=location.href.split("#")[1];t=t.split("&id=")[0]+"&id=";let a=t+e.wf_id+(this.wfd_id?"&wfd_id="+this.wfd_id:"");this.props.history.push(a),this.loadPage()}))}},"确定"),"  ",s.createElement("button",{type:"button",className:"btn btn-green btn-outlined btn-xs",onClick:()=>{this.setState({curAction:null,actionData:null})}},"取消"))))}renderTimeline(){return this.state.wf.steps?s.createElement("div",{className:"timeline"},s.createElement("div",{className:"time-label"},s.createElement("span",{className:"bg-darkgreen"},"   开始")),this.state.wf.steps.map(((e,t)=>s.createElement(s.Fragment,{key:t},s.createElement("div",null,s.createElement("i",{className:"fas fa-user bg-blue"}),s.createElement(c,{step:e,workflowApiUrl:this.workflowApiUrl})),s.createElement("div",{className:"time-label"},"结束"===e.nextstate?s.createElement("span",{className:"bg-darkgreen"},"   结束"):s.createElement("span",{style:{fontSize:".97em",color:"#1a7930"}},e.nextstate)))))):null}}class c extends s.Component{constructor(e){super(e),this.state={}}render(){let e=this.props.step;return s.createElement("div",{className:"timeline-item"},s.createElement("span",{className:"time"},s.createElement("i",{className:"fas fa-clock"})," ",UTCTimeString2Local(e.actiondate)),s.createElement("h3",{className:"timeline-header",onClick:()=>{void 0===e.viewdata?e.viewdata=!0:e.viewdata=!e.viewdata,void 0===e.actiondata&&i._Y.ajax_get(this.props.workflowApiUrl,{action:"getstepactiondata",step_id:e.id},(t=>{e.actiondata=t.data,this.forceUpdate()})),this.forceUpdate()}},s.createElement("a",null,e.operator__realname)," ",e.actionname),e.viewdata&&e.actiondata?s.createElement("div",{className:"timeline-body"},s.createElement(r.D,{fields:e.actiondata})):null)}}},6671:(e,t,a)=>{"use strict";a.d(t,{m:()=>c,_:()=>p});var s=a(8463),r=a(6872);a(233),a(7294);let i="通用工作流-",l="/api/wf_general",n="/wf_general_one?id=",o="/wf_general_list";class c extends s.a{constructor(e){super(e),this.workflowname=i,this.workflowApiUrl=l,this.handleOneUrl=n,this.listAllUrl=o,this.itemFields=[{name:"",attr:"title",type:"OneLineText"}],this.pagesize=10,this.wfd_id=r._Y.getUrlParameter("wfd_id"),this.api_list_action="listallbypage"}componentDidMount(){r._Y.ajax_get(this.workflowApiUrl,{action:"canicreatewf",wfd_id:this.wfd_id},(e=>{this.workflowname=e.wf_name,this.setState({canCreateWF:e.permitted})}))}clickCreateWorkFlowRec(){this.props.history.push(`${this.handleOneUrl}-1&wfd_id=${this.wfd_id}`)}async listbypage(e,t=""){let a={action:"listbypage",pagenum:e,pagesize:this.pagesize,keywords:t,wfd_id:this.wfd_id},s=await r._Y.rfetch("post",this.workflowApiUrl,a);this.info.data=s,self.forceUpdate()}searchResultCssClass(e){switch(e.currentstate){case"中止":return"search-result-item banned";case"结束":return"search-result-item";default:return"search-result-item plane"}}}class p extends s.O{constructor(e){super(e),this.workflowname=i,this.workflowApiUrl=l,this.handleOneUrl=n,this.listAllUrl=o,this.wfd_id=r._Y.getUrlParameter("wfd_id")}loadPage(){let e=parseInt(r._Y.getUrlParameter("id"));this.getWorkFlowRec(e)}getWorkFlowRec(e){r._Y.ajax_get(this.workflowApiUrl,{action:"getone",wf_id:e,wfd_id:this.wfd_id,withwhatcanido:!0},(e=>{this.workflowname=e.wf_name,this.setState({wf:e.rec,avalialeActions:e.whaticando,curAction:null,actionData:null})}))}clickViewList(){this.props.history.push(this.listAllUrl+"?wfd_id="+this.wfd_id)}}}}]);